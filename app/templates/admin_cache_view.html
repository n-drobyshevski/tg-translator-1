<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Channel Cache Viewer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <a class="btn btn-outline-secondary mb-3" href="/admin">‚Üê Admin Dashboard</a>
        <h2>Channel Cache Viewer</h2>
        <form class="mb-4" method="get">
            <div class="row g-2 align-items-center">
                <div class="col-auto">
                    <label for="channel_filter" class="col-form-label">Filter by Channel:</label>
                </div>
                <div class="col-auto">
                    <select id="channel_filter" name="channel" class="form-select" onchange="this.form.submit()">
                        <option value="">All Channels</option>
                        {% for cid, cname in channel_id_to_name.items() %}
                            <option value="{{ cid }}" {% if request.args.get('channel') == cid %}selected{% endif %}>{{ cname }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </form>
        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        {% if cache_data %}
            {% set selected_channel = request.args.get('channel') %}
            {% for channel_id, messages in cache_data.items() %}
                {% if not selected_channel or selected_channel == channel_id %}
                <div class="card mb-4">
                    <div class="card-header">
                        <b>Channel:</b>
                        {{ channel_id_to_name.get(channel_id, "Unknown") }}
                        <span class="text-muted">(ID: {{ channel_id }}, {{ messages|length }} messages)</span>
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for msg in messages %}
                            <li class="list-group-item">
                                <div><b>Message ID:</b> {{ msg.message_id }}</div>
                                <div>
                                    <b>Date:</b>
                                    {% if msg.date_readable %}
                                        {{ msg.date_readable }}
                                    {% else %}
                                        {{ msg.date }}
                                    {% endif %}
                                </div>
                                <div><b>Rendered HTML:</b>
                                    <div class="border rounded p-2 bg-white" style="white-space: pre-wrap;">
                                        {{ msg.html | safe }}
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="alert alert-info">No cache data found.</div>
        {% endif %}
    </div>
</body>
</html>
