<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Removed FontAwesome; using inline SVGs for icons -->
    <!-- FontAwesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto mt-8">
      <div class="flex items-center mb-6 justify-between">
        <h1 class="text-3xl font-bold">Admin Dashboard</h1>
        <form action="{{ url_for('logout') }}" method="get" class="m-0">
          <button
            type="submit"
            class="px-4 py-2 text-red-600 rounded hover:bg-red-50 transition flex items-center"
          >
            Logout
          </button>
        </form>
      </div>
      <hr class="mb-6" />

      <!-- Main content: Charts and KPIs -->
      <div class="flex flex-col lg:flex-row gap-6 mb-8">
        <!-- Left column: Charts -->
        <div class="w-full lg:w-2/3 flex flex-col gap-6">
          <!-- Main chart: Posts by channel -->
          <div
            class="bg-white rounded-xl shadow p-4 flex flex-col h-80 justify-between"
          >
            <h2 class="font-semibold mb-2">Posts by channel — last 10 days</h2>
            <canvas
              id="chartPosts10dChannels"
              class="w-full flex-1"
              style="height: 180px; min-height: 0"
            ></canvas>
          </div>

          <!-- Secondary charts row -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-64">
            <!-- Posts last 10 days chart -->
            <div class="bg-white rounded-xl shadow p-4">
              <h2 class="font-semibold mb-2">Posts — last 10 days</h2>
              <canvas id="chartPosts10d" class="w-full h-64"></canvas>
            </div>
            <!-- Heatmap chart -->
            <div class="bg-white rounded-xl shadow p-4">
              <h2 class="font-semibold mb-2">
                Heatmap — posts by hour &amp; weekday
              </h2>
              <canvas id="heatmapChart" class="w-full h-64"></canvas>
            </div>
          </div>
        </div>

        <!-- Right column: KPI Cards and Quick Links -->
        <div class="w-full lg:w-1/3 grid grid-cols-2 gap-4">
          <!-- KPI Cards Container -->
          <div class="col-span-2">
            <div class="grid grid-cols-2 gap-4 h-80">
              <div
                class="bg-white rounded-lg shadow p-4 flex flex-col items-center"
              >
                <div class="text-2xl font-bold text-blue-700 mb-1">
                  {{ stats.total_posts }}
                </div>
                <div class="text-gray-500 text-sm">Total posts</div>
              </div>
              <div
                class="bg-white rounded-lg shadow p-4 flex flex-col items-center"
              >
                <div class="text-2xl font-bold text-green-700 mb-1">
                  {{ stats.success_rate }}%
                </div>
                <div class="text-gray-500 text-sm">Success rate</div>
              </div>
              <div
                class="bg-white rounded-lg shadow p-4 flex flex-col items-center"
              >
                <div class="text-2xl font-bold text-cyan-700 mb-1">
                  {{ stats.avg_latency }}
                </div>
                <div class="text-gray-500 text-sm">Avg latency (s)</div>
              </div>
              <div
                class="bg-white rounded-lg shadow p-4 flex flex-col items-center"
              >
                <div class="text-lg font-bold text-gray-700 mb-1">
                  {{ stats.latest_timestamp | datetimeformat }}
                </div>
                <div class="text-gray-500 text-sm">Latest timestamp</div>
              </div>
              <div
                class="bg-white rounded-lg shadow p-4 flex flex-col items-center col-span-2"
              >
                <div class="text-lg font-bold text-indigo-700 mb-1">
                  {{ stats.busiest_pair }}
                </div>
                <div class="text-gray-500 text-sm">
                  Busiest channel ({{ stats.busiest_pair_percent }}%)
                </div>
              </div>
            </div>
          </div>

          <div
            class="col-span-2 bg-white rounded-lg shadow p-4 flex flex-col justify-between h-64"
          >
            <h3 class="font-semibold mb-3">Quick Links</h3>
            <ul class="space-y-2 flex-1 flex flex-col justify-center">
              <li>
                <a
                  href="/admin/config"
                  class="flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition"
                >
                  <i class="fas fa-cog mr-2"></i>
                  Configuration
                </a>
              </li>
              <li>
                <a
                  href="/admin/manager"
                  class="flex items-center px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition"
                >
                  <i class="fas fa-clipboard-list mr-2"></i>
                  Message Manager
                </a>
              </li>
              <li>
                <a
                  href="/admin/cache"
                  class="flex items-center px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition"
                >
                  <i class="fas fa-database mr-2"></i>
                  Channel Cache
                </a>
              </li>
              <li>
                <a
                  href="/admin/stats"
                  class="flex items-center px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
                >
                  <i class="fas fa-chart-bar mr-2"></i>
                  View Stats
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.2.0/dist/chartjs-chart-matrix.min.js"></script>
    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
  </body>
</html>
